*** Setting ***

Library  robotframework_httplibrary.HTTP
Library  OperatingSystem

Suite Setup     Start Mockserver
Suite Teardown  Stop Mockserver

*** Variables ***

${HOST}  localhost:36503

*** Test Cases ***

Error if GET before connect
    ${msg}=             Run Keyword And Expect Error  *  GET   /
    Should Start With   ${msg}    Not connected to any HTTP Host

Simple GET
    [Setup]  Connect  ${HOST}
    GET      /200

GET 200
    [Setup]  Connect  ${HOST}
    GET      /200
    Response Status Code Should Equal   200

GET 302
    [Setup]  Connect  ${HOST}
    GET      /302
    Response Status Code Should Equal   302

GET 302 with follow
    [Setup]  Connect  ${HOST}
    GET      /302
    Follow Response
    Response Status Code Should Equal   200

GET 418
    [Setup]  Connect  ${HOST}
    GET      /418
    Response Status Code Should Equal   418 I'm a teapot

Response Should Succeed OK
    [Setup]  Connect  ${HOST}
    GET      /200
    Response Should Succeed

Response Should Succeed FAIL
    [Setup]  Connect  ${HOST}
    GET      /404
    Run Keyword And Expect Error  *  Response Should Succeed
    
Response Should Not Succeed OK
    [Setup]  Connect  ${HOST}
    GET      /503
    Response Should Not Succeed

Response Should Not Succeed FAIL
    [Setup]  Connect  ${HOST}
    GET      /200
    Run Keyword And Expect Error  *  Response Should Not Succeed

Response Should Have Header OK
    [Setup]  Connect  ${HOST}
    GET      /302
    Response Should Have Header  Location

Response Should Have Header FAIL
    [Setup]  Connect  ${HOST}
    GET      /200
    Run Keyword And Expect Error  *  Response Should Have Header  Krytzmyk

Response Should Not Have Header OK
    [Setup]  Connect  ${HOST}
    GET      /404
    Response Should Not Have Header  Location

Response Should Not Have Header FAIL
    [Setup]  Connect  ${HOST}
    GET      /302
    Run Keyword And Expect Error  *  Response Should Not Have Header  Location

Response Header Should Equal OK
    [Setup]  Connect  ${HOST}
    GET      /302
    Response Header Should Equal   Location  /200

Response Header Should Equal FAIL
    [Setup]  Connect  ${HOST}
    GET      /302
    Run Keyword And Expect Error  *  Response Header Should Equal   Location  http://some.other.host/

Response Header Should Not Equal OK
    [Setup]  Connect  ${HOST}
    GET      /302
    Response Header Should Not Equal   Location  http://and.another.host/

Response Header Should Not Equal FAIL
    [Setup]  Connect  ${HOST}
    GET      /302
    Run Keyword And Expect Error  *  Response Header Should Not Equal   Location  /200

Simple POST request
    [Setup]  Connect  ${HOST}
    POST      /echo
    Response Should Succeed


Set Request Header
    [Setup]  Connect                    ${HOST}
    Set Request Header                  If-Modified-Since  February
    GET                                 /304
    Response Status Code Should Equal   304

*** Keywords ***

Start Mockserver
    Start Process  tests/mockserver.py
    Sleep  0.2

Stop Mockserver
    Connect  ${HOST}
    POST     /kill

